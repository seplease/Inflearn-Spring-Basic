6.5 스프링 AOP
=
## 6.5.1 자동 프록시 생성
- 투명한 부가기능 적용
  - 타깃 코드의 깔끔한 유지
  - 부가기능은 한 번만 만들어 모든 타깃과 메소드에 재사용 가능
  - 타깃의 적용 메소드를 선택하는 방식도 독립적으로 작업할 수 있도록 분리됨
- 남은 과제: 타깃 오브젝트의 비슷한 설정 문제
  - 예를 들어, 새로운 타깃이 추가될 때마다 ProxyFactoryBean 설정을 반복하여 추가해야 함
  - 이 문제를 해결하기 위해 스프링은 설정 자동등록 기법을 제안

### 중복 문제의 위한 접근 방법
- 스프링은 기존에 반복적인 설정 작업을 해결하기 위해, 자동 프록시 생성 기능을 도입
  - 자동 프록시 생성기는 특정 인터페이스를 구현한 오브젝트에 대해 자동으로 프록시를 생성해 줌
  - 반복적인 설정 문제를 해결하기 위해, 스프링은 ProxyFactoryBean을 통해 생성된 프록시 오브젝트를 자동으로 생성되도록 빈 설정을 자동화하는 방법을 제공

### 빈 후처리기를 이용한 자동 프록시 생성기
- 스프링은 OCP(개방-폐쇄 원칙)를 준수하면서 애플리케이션에 확장 가능하도록 빈 후처리기(BeanPostProcessor) 기능을 제공
  - DefaultAdvisorAutoProxyCreator라는 빈 후처리기를 통해 어드바이저를 자동으로 적용해주는 프록시 생성기를 사용
  - 빈 후처리기는 스프링 컨테이너에 등록된 빈 오브젝트를 가로채서 프록시로 변환하거나 추가적인 작업을 수행 가능

### 확장된 포인트컷
- 확장된 포인트컷은 타깃 오브젝트의 특정 메소드가 아닌 모든 메소드에 대해 부가기능을 적용할 수 있도록 해줌
  - 특정 클래스의 모든 메소드에 대한 필터링 및 포인트컷 적용 가능
  - 포인트컷은 메소드 레벨뿐만 아니라 클래스 레벨의 필터링과 부가기능 적용을 함께 할 수 있게 설계

## 6.5.2 DefaultAdvisorAutoProxyCreator의 적용
- DefaultAdvisorAutoProxyCreator
  - 어드바이저(Advisor)를 이용한 자동 프록시 생성기 역할을 하는 빈 후처리기
- 빈 후처리기는 스프링 컨테이너에서 빈이 생성될 때마다 해당 빈을 가로채서 추가적인 작업을 수행할 수 있게 함
- 이를 스프링에 적용하려면, DefaultAdvisorAutoProxyCreator를 빈으로 등록
- 빈이 생성될 때마다, 빈 후처리기는 이 빈이 프록시 적용 대상인지 확인
- 빈이 어드바이저 내의 포인트컷과 일치하면, 프록시 생성기가 해당 빈의 프록시를 생성하고, 어드바이저를 프록시에 연결
- 최종적으로 빈 후처리기는 프록시가 생성된 빈을 반환하며, 이 프록시가 스프링 컨테이너에 빈으로 등록되어 사용됨
## 6.5.3 포인트컷 표현식을 이용한 포인트컷
### 포인트컷 표현식
- 기존 포인트컷은 메소드와 클래스 이름 패턴을 이용해 부가기능을 적용함
- 포인트컷 표현식을 사용하면 정규식을 통해 더 정교하게 메소드를 선택 가능
- AspectJExpressionPointcut을 활용해 메소드 접근제어자, 리턴 타입, 메소드 이름, 파라미터, 예외 타입 등을 기준으로 포인트컷을 정의 가능

### 포인트컷 표현식 문법
```java
execution([접근제한자 패턴] 타입패턴 [타입패턴.]이름패턴(타입패턴 | "..", ...))
```
- execution() 지시자를 사용해 메소드 실행 시점을 포인트로 설정
- 다양한 필터링 옵션으로 특정 메소드를 타겟팅할 수 있음
- 예: execution(public * *(..))은 모든 public 메소드를 타겟으로 함

### 포인트컷 표현식 테스트
- 포인트컷 표현식이 예상대로 작동하는지 테스트를 통해 확인
- 테스트는 메소드의 여러 속성을 기준으로 필터링이 제대로 되는지 검증
- 포인트컷 표현식을 통해 더 정교한 AOP 설정이 가능

### 포인트컷 표현식을 이용한 포인트컷 적용
- AspectJ 포인트컷 표현식을 사용해 특정 메서드나 클래스에 트랜잭션이나 기타 부가기능을 적용할 수 있음
- transactionPointcut과 같은 빈을 설정 파일에 등록하고, AspectJExpressionPointcut을 사용해 포인트컷 표현식을 지정하여 적용
- 포인트컷 표현식을 사용하면 복잡한 클래스나 메서드 필터링 로직을 간단하게 처리할 수 있음

## 타입 패턴과 클래스 이름 패턴
- 클래스 이름이나 타입 패턴을 이용해 특정 빈이나 메서드에 포인트컷을 적용할 수 있음
- 클래스 이름 패턴을 사용해 특정 접두사나 접미사를 가진 클래스에만 부가기능을 적용할 수 있음
- 테스트를 통해 클래스 이름 패턴과 포인트컷 표현식이 의도한 대로 동작하는지 검증

## 6.5.4 AOP란 무엇인가?
### 트랜잭션 서비스 추상화
- 트랜잭션 경계설정을 비즈니스 로직에서 분리하여 코드의 일관성을 유지하고 관리가 용이하도록 하는 작업.
- 트랜잭션 관련 코드는 독립된 모듈로 추상화하여 비즈니스 로직과 분리, 유지보수와 재사용성을 높임.

### 프록시와 데코레이터 패턴
- 프록시와 데코레이터 패턴을 활용하여, 부가기능을 핵심 로직과 독립적으로 적용하는 방식.
- 이 패턴은 비즈니스 로직을 변경하지 않고, 프록시를 통해 트랜잭션 관리 등 부가기능을 제공함.

### 다이나믹 프록시와 프록시 팩토리 빈
- JDK 다이나믹 프록시를 활용하여 런타임에 프록시를 생성하고, 트랜잭션 기능 등을 부여.
- 스프링의 프록시 팩토리 빈은 이러한 작업을 보다 편리하게 해주며, 코드 재사용성을 높여줌.

### 자동 프록시 생성 방법과 포인트컷
- 스프링의 자동 프록시 생성 기능을 이용하면, 컨테이너가 빈을 생성할 때 자동으로 프록시를 만들고 부가기능을 부여 가능.
- 포인트컷을 통해 어떤 메소드에 부가기능을 적용할지 선택할 수 있으며, 특정 메소드나 클래스에만 선택적으로 적용 가능.

### 부가기능의 모듈화
- 핵심 로직과 부가기능을 분리하여 모듈화하는 것이 AOP의 핵심 목표.
- 트랜잭션 같은 부가기능을 독립적인 모듈로 관리해, 코드의 복잡성을 줄이고 유지보수성을 높이는 것이 목적.
- 부가기능은 필요할 때만 조합되어 동작하며, 이로 인해 코드의 재사용성과 유연성을 제공함.

## 6.5.5 AOP 적용기술
- 프록시를 이용한 AOP
  - 스프링의 IoC/DI 컨테이너와 다양한 AOP 기술들을 사용해 애플리케이션의 메서드 호출 과정에 부가기능을 추가하는 방법.
  - 기본적으로 프록시를 사용하며, 이를 통해 메서드 호출 시 다양한 부가기능을 제공.
  - MethodInterceptor 인터페이스를 통해 다이내믹 프록시의 요청 정보를 받아 처리.
- 바이트코드 생성과 조작을 통한 AOP
  - 프록시 방식 외에도 AspectJ와 같은 프레임워크를 통해 바이트코드 조작을 통해 부가기능을 추가하는 방법.
  - 프록시 방식보다 더 강력하고 다양한 부가기능을 제공할 수 있으나, 설정과 사용이 복잡함.
  - 특정 클래스의 바이트코드를 직접 수정하여 메서드 호출 시점에 부가기능을 삽입.

## 6.5.6 AOP의 용어
- 타깃 (Target)
  - 부가기능을 적용할 대상 객체
  - 주로 핵심 비즈니스 로직을 담당하는 클래스이거나, 또 다른 부가기능을 제공하는 프록시 객체가 될 수 있다.
- 어드바이스 (Advice)
  - 타깃 객체에 제공할 부가기능을 담고 있는 모듈
  - AOP에서 어드바이스는 실행 시점에 따라 다양한 방식으로 타깃에 적용된다.
- 조인 포인트 (Join Point)
  - 어드바이스가 적용될 수 있는 구체적인 위치
  - 스프링 AOP에서는 주로 메소드 실행 단계가 조인 포인트로 사용되며, 타깃 객체가 구현한 모든 메소드가 조인 포인트가 될 수 있다.
- 포인트컷 (Pointcut)
  - 어드바이스를 적용할 조인 포인트를 선별하는 기준 또는 기능을 정의한 모듈
  - 스프링 AOP에서는 주로 메소드의 실행 시점에 대한 기준을 정의하며, execution()과 같은 표현식을 통해 특정 메소드를 선택한다.
- 프록시 (Proxy)
  - 타깃 객체와 클라이언트 사이에 투명하게 존재하며, 부가기능을 제공하는 객체. DI(Dependency Injection)를 통해 클라이언트에게 타깃 대신 주입되어 작동한다.
- 어드바이저 (Advisor)
  - 하나의 포인트컷과 하나의 어드바이스를 결합한 객체
  - 어드바이저는 어디에 어떤 부가기능을 적용할지 결정하는 스프링 AOP의 기본 모듈로, 자동 프록시 생성기를 통해 작업 정보로 사용된다.
- 애스펙트 (Aspect)
  - AOP의 기본 모듈로
  - 하나 이상의 포인트컷과 어드바이스의 조합으로 구성된다.
  - 보통 싱글톤 객체 형태로 존재하며, 스프링의 어드바이저는 단순한 애스펙트의 형태로 간주될 수 있다.

## 6.5.7 AOP 네임스페이스
- 스프링 AOP를 더 쉽게 사용할 수 있도록 네임스페이스를 제공
- 네임스페이스를 활용해 AOP 관련 설정을 간편하게 구성할 수 있음
- 이를 통해 AOP 관련 설정이 더 직관적이고 관리하기 쉬워짐